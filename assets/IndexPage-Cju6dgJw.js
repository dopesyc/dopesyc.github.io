import{c as L,ap as oe,aq as ae,h as y,a as u,i as K,n as ne,ar as W,g as V,ae as q,ai as G,V as X,x as le,z as ie,r as z,as as se,C as re,b as Y,K as ce,e as A,l as de,$ as ue,H as fe,U as ge,F as pe,w as I,af as j,a1 as B,a5 as s,a0 as O,a4 as r,ab as R,a7 as N,a2 as _,a8 as H,ad as x,a6 as $,ag as me}from"./index-uycLlxS2.js";import{Q as k}from"./QTooltip-CYsWlyF6.js";import{u as ve,a as ye}from"./QSelect-Dzl-7L6b.js";import{Z as be,Q as he}from"./ZoneDetailsDialog-CZJ3rY1x.js";import{L as T}from"./leaflet-src-BGuZJXnX.js";import{_ as _e}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Ce='<circle cx="15" cy="15" r="15"><animate attributeName="r" from="15" to="15" begin="0s" dur="0.8s" values="15;9;15" calcMode="linear" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" from="1" to="1" begin="0s" dur="0.8s" values="1;.5;1" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="60" cy="15" r="9" fill-opacity=".3"><animate attributeName="r" from="9" to="9" begin="0s" dur="0.8s" values="9;15;9" calcMode="linear" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" from=".5" to=".5" begin="0s" dur="0.8s" values=".5;1;.5" calcMode="linear" repeatCount="indefinite"></animate></circle><circle cx="105" cy="15" r="15"><animate attributeName="r" from="15" to="15" begin="0s" dur="0.8s" values="15;9;15" calcMode="linear" repeatCount="indefinite"></animate><animate attributeName="fill-opacity" from="1" to="1" begin="0s" dur="0.8s" values="1;.5;1" calcMode="linear" repeatCount="indefinite"></animate></circle>',xe=L({name:"QSpinnerDots",props:oe,setup(e){const{cSize:o,classes:n}=ae(e);return()=>y("svg",{class:n.value,fill:"currentColor",width:o.value,height:o.value,viewBox:"0 0 120 30",xmlns:"http://www.w3.org/2000/svg",innerHTML:Ce})}}),Se=["top","right","bottom","left"],D={type:{type:String,default:"a"},outline:Boolean,push:Boolean,flat:Boolean,unelevated:Boolean,color:String,textColor:String,glossy:Boolean,square:Boolean,padding:String,label:{type:[String,Number],default:""},labelPosition:{type:String,default:"right",validator:e=>Se.includes(e)},externalLabel:Boolean,hideLabel:{type:Boolean},labelClass:[Array,String,Object],labelStyle:[Array,String,Object],disable:Boolean,tabindex:[Number,String]};function J(e,o){return{formClass:u(()=>`q-fab--form-${e.square===!0?"square":"rounded"}`),stacked:u(()=>e.externalLabel===!1&&["top","bottom"].includes(e.labelPosition)),labelProps:u(()=>{if(e.externalLabel===!0){const n=e.hideLabel===null?o.value===!1:e.hideLabel;return{action:"push",data:{class:[e.labelClass,`q-fab__label q-tooltip--style q-fab__label--external q-fab__label--external-${e.labelPosition}`+(n===!0?" q-fab__label--external-hidden":"")],style:e.labelStyle}}}return{action:["left","top"].includes(e.labelPosition)?"unshift":"push",data:{class:[e.labelClass,`q-fab__label q-fab__label--internal q-fab__label--internal-${e.labelPosition}`+(e.hideLabel===!0?" q-fab__label--internal-hidden":"")],style:e.labelStyle}}})}}const ee={start:"self-end",center:"self-center",end:"self-start"},ke=Object.keys(ee),Z=L({name:"QFabAction",props:{...D,icon:{type:String,default:""},anchor:{type:String,validator:e=>ke.includes(e)},to:[String,Object],replace:Boolean},emits:["click"],setup(e,{slots:o,emit:n}){const c=K(W,()=>({showing:{value:!0},onChildClick:ne})),{formClass:d,labelProps:f}=J(e,c.showing),g=u(()=>{const l=ee[e.anchor];return d.value+(l!==void 0?` ${l}`:"")}),i=u(()=>e.disable===!0||c.showing.value!==!0);function v(l){c.onChildClick(l),n("click",l)}function C(){const l=[];return o.icon!==void 0?l.push(o.icon()):e.icon!==""&&l.push(y(G,{name:e.icon})),(e.label!==""||o.label!==void 0)&&l[f.value.action](y("div",f.value.data,o.label!==void 0?o.label():[e.label])),X(o.default,l)}const S=V();return Object.assign(S.proxy,{click:v}),()=>y(q,{class:g.value,...e,noWrap:!0,stack:e.stacked,icon:void 0,label:void 0,noCaps:!0,fabMini:!0,disable:i.value,onClick:v},C)}}),we=["up","right","down","left"],$e=["left","center","right"],qe=L({name:"QFab",props:{...D,...ie,icon:String,activeIcon:String,hideIcon:Boolean,hideLabel:{...D.hideLabel,default:null},direction:{type:String,default:"right",validator:e=>we.includes(e)},persistent:Boolean,verticalActionsAlign:{type:String,default:"center",validator:e=>$e.includes(e)}},emits:le,setup(e,{slots:o}){const n=z(null),c=z(e.modelValue===!0),d=se(),{proxy:{$q:f}}=V(),{formClass:g,labelProps:i}=J(e,c),v=u(()=>e.persistent!==!0),{hide:C,toggle:S}=re({showing:c,hideOnRouteChange:v}),l=u(()=>({opened:c.value})),h=u(()=>`q-fab z-fab row inline justify-center q-fab--align-${e.verticalActionsAlign} ${g.value}`+(c.value===!0?" q-fab--opened":" q-fab--closed")),p=u(()=>`q-fab__actions flex no-wrap inline q-fab__actions--${e.direction} q-fab__actions--${c.value===!0?"opened":"closed"}`),w=u(()=>{const a={id:d.value,role:"menu"};return c.value!==!0&&(a["aria-hidden"]="true"),a}),b=u(()=>`q-fab__icon-holder  q-fab__icon-holder--${c.value===!0?"opened":"closed"}`);function M(a,t){const m=o[a],F=`q-fab__${a} absolute-full`;return m===void 0?y(G,{class:F,name:e[t]||f.iconSet.fab[t]}):y("div",{class:F},m(l.value))}function Q(){const a=[];return e.hideIcon!==!0&&a.push(y("div",{class:b.value},[M("icon","icon"),M("active-icon","activeIcon")])),(e.label!==""||o.label!==void 0)&&a[i.value.action](y("div",i.value.data,o.label!==void 0?o.label(l.value):[e.label])),X(o.tooltip,a)}return ce(W,{showing:c,onChildClick(a){C(a),a?.qAvoidFocus!==!0&&n.value?.$el.focus()}}),()=>y("div",{class:h.value},[y(q,{ref:n,class:g.value,...e,noWrap:!0,stack:e.stacked,align:void 0,icon:void 0,label:void 0,noCaps:!0,fab:!0,"aria-expanded":c.value===!0?"true":"false","aria-haspopup":"true","aria-controls":d.value,onClick:S},Q),y("div",{class:p.value,...w.value},Y(o.default))])}}),ze={position:{type:String,default:"bottom-right",validator:e=>["top-right","top-left","bottom-right","bottom-left","top","right","bottom","left"].includes(e)},offset:{type:Array,validator:e=>e.length===2},expand:Boolean};function Me(){const{props:e,proxy:{$q:o}}=V(),n=K(de,A);if(n===A)return console.error("QPageSticky needs to be child of QLayout"),A;const c=u(()=>{const l=e.position;return{top:l.indexOf("top")!==-1,right:l.indexOf("right")!==-1,bottom:l.indexOf("bottom")!==-1,left:l.indexOf("left")!==-1,vertical:l==="top"||l==="bottom",horizontal:l==="left"||l==="right"}}),d=u(()=>n.header.offset),f=u(()=>n.right.offset),g=u(()=>n.footer.offset),i=u(()=>n.left.offset),v=u(()=>{let l=0,h=0;const p=c.value,w=o.lang.rtl===!0?-1:1;p.top===!0&&d.value!==0?h=`${d.value}px`:p.bottom===!0&&g.value!==0&&(h=`${-g.value}px`),p.left===!0&&i.value!==0?l=`${w*i.value}px`:p.right===!0&&f.value!==0&&(l=`${-w*f.value}px`);const b={transform:`translate(${l}, ${h})`};return e.offset&&(b.margin=`${e.offset[1]}px ${e.offset[0]}px`),p.vertical===!0?(i.value!==0&&(b[o.lang.rtl===!0?"right":"left"]=`${i.value}px`),f.value!==0&&(b[o.lang.rtl===!0?"left":"right"]=`${f.value}px`)):p.horizontal===!0&&(d.value!==0&&(b.top=`${d.value}px`),g.value!==0&&(b.bottom=`${g.value}px`)),b}),C=u(()=>`q-page-sticky row flex-center fixed-${e.position} q-page-sticky--${e.expand===!0?"expand":"shrink"}`);function S(l){const h=Y(l.default);return y("div",{class:C.value,style:v.value},e.expand===!0?h:[y("div",h)])}return{$layout:n,getStickyContent:S}}const Fe=L({name:"QPageSticky",props:ze,setup(e,{slots:o}){const{getStickyContent:n}=Me();return()=>n(o)}}),Pe={key:0,class:"absolute-center"},Be={key:1,class:"map-container"},Te={class:"map-controls"},Le={class:"control-panel"},Qe={class:"q-gutter-xs"},Ae={key:0,class:"zone-info-panel"},Ie={class:"text-weight-medium"},Oe={class:"text-caption text-grey"},Ne={class:"q-mt-xs"},U=14,Ze={__name:"IndexPage",setup(e){const o=ue(),n=ve(),c=z(null),d=z(null),f=z(!0),g=z(!0);let i=null,v=[];const C=[49.671151141711434,-96.65296535699862],S={Monday:"#2196F3",Tuesday:"#4CAF50",Wednesday:"#FF9800",Thursday:"#9C27B0",Friday:"#241FE0"};fe(async()=>{console.log("IndexPage mounted"),n.setNotifyFunction&&o.notify&&n.setNotifyFunction(o.notify),await l(),await h()}),ge(()=>{console.log("IndexPage unmounting"),i&&(i.remove(),i=null)});const l=async()=>{try{console.log("Loading zones..."),await n.initializeStore(),console.log("Zones loaded:",n.zones.length),i&&p()}catch(a){console.error("Failed to load zones:",a),o.notify&&o.notify({color:"negative",message:"Failed to load zones",icon:"error"})}},h=async()=>{if(await pe(),await new Promise(a=>setTimeout(a,100)),!c.value){console.error("Map container not found");return}try{console.log("Initializing map..."),console.log("Leaflet object:",T),console.log("Map container element:",document.getElementById("map")),i=T.map("map",{preferCanvas:!1,zoomControl:!0,attributionControl:!0}).setView(C,U),console.log("Map created:",i);const a=T.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"Â© OpenStreetMap contributors",maxZoom:19,tileSize:256,zoomOffset:0});a.on("tileerror",t=>{console.warn("Tile load error:",t)}),a.on("tileload",()=>{console.log("Tile loaded successfully")}),a.addTo(i),console.log("Tile layer added"),setTimeout(()=>{i&&(console.log("Invalidating map size..."),i.invalidateSize(!0),i.eachLayer(t=>{t.redraw&&t.redraw()}))},200),console.log("Map initialized successfully"),p()}catch(a){console.error("Error initializing map:",a),o.notify&&o.notify({color:"negative",message:"Failed to initialize map",icon:"error"})}},p=()=>{if(!i){console.log("Map not ready for adding zones");return}console.log("Adding zones to map with filters...",{day:n.filters.day,completed:n.filters.completed,priority:n.filters.priority}),v.forEach(t=>{i.removeLayer(t)}),v=[];const a=n.filteredZones;if(console.log(`Showing ${a.length} zones after filtering`),a.forEach(t=>{try{if(!f.value&&t.completed||!g.value&&!t.completed)return;const m=S[t.scheduledDay],F=t.completed?m:"#FF0000",te=t.completed?.7:.9,E=t.completed?.4:.6,P=T.polygon(t.coordinates,{color:F,fillColor:F,fillOpacity:E,weight:3,opacity:te}).addTo(i);P.on("click",()=>{w(t)}),P.on("mouseover",function(){d.value=t,this.setStyle({weight:5,fillOpacity:.8})}),P.on("mouseout",function(){d.value=null,this.setStyle({weight:3,fillOpacity:E})}),P.bindTooltip(`
        <div style="text-align: center;">
          <strong>${t.name}</strong><br>
          <span style="color: ${m};">${t.scheduledDay}</span><br>
          ${t.completed?"â Complete":"â³ Pending"}
        </div>
      `,{permanent:!1,direction:"top",className:"zone-tooltip"}),v.push(P),console.log(`Added zone: ${t.name}`)}catch(m){console.error(`Error adding zone ${t.name}:`,m)}}),v.length>0)try{const t=new T.featureGroup(v);i.fitBounds(t.getBounds().pad(.1)),console.log("Map bounds fitted to filtered zones")}catch(t){console.error("Error fitting bounds:",t)}console.log(`Added ${v.length} zones to map`)},w=a=>{n.selectZone(a),o.notify&&o.notify({color:"info",message:`Selected: ${a.name}`,icon:"info",timeout:1e3})},b=async()=>{o.loading&&o.loading.show({message:"Refreshing zones..."});try{await l(),o.notify&&o.notify({color:"positive",message:"Map refreshed successfully",icon:"refresh"})}catch(a){console.error("Failed to refresh map:",a),o.notify&&o.notify({color:"negative",message:"Failed to refresh map",icon:"error"})}finally{o.loading&&o.loading.hide()}},M=()=>{i&&(i.setView(C,U),o.notify&&o.notify({color:"info",message:"Map centered on Ste. Anne",icon:"my_location",timeout:1e3}))},Q=()=>{const a=new Date().toLocaleDateString("en-US",{weekday:"long"}),t=n.zones.filter(m=>m.scheduledDay===a&&!m.completed);if(t.length===0){o.notify&&o.notify({type:"info",message:`All ${a} zones are already completed!`,icon:"check_circle"});return}o.dialog&&o.dialog({title:"Mark Today Complete",message:`Mark all ${t.length} ${a} zones as completed?`,cancel:!0,persistent:!0,ok:{color:"positive",label:"Mark Complete"}}).onOk(async()=>{for(const m of t)await n.updateZoneStatus(m.id,!0)})};return I(()=>n.zones,()=>{i&&p()},{deep:!0}),I([f,g],()=>{i&&p()}),I(()=>n.filters,()=>{i&&(console.log("Filters changed, updating map"),p())},{deep:!0}),(a,t)=>(B(),j(he,{class:"map-page"},{default:s(()=>[N(n).loading?(B(),O("div",Pe,[r(xe,{size:"50px",color:"primary"}),t[2]||(t[2]=_("div",{class:"text-center q-mt-md"},"Loading zones...",-1))])):(B(),O("div",Be,[_("div",{id:"map",ref_key:"mapContainer",ref:c},null,512),_("div",Te,[_("div",Le,[r(H,{flat:"",bordered:"",class:"q-pa-sm"},{default:s(()=>[t[4]||(t[4]=_("div",{class:"text-caption text-grey q-mb-xs"},"Quick Actions",-1)),_("div",Qe,[r(q,{dense:"",size:"sm",color:"positive",icon:"visibility",onClick:t[0]||(t[0]=m=>f.value=!f.value),outline:!f.value},{default:s(()=>[r(k,null,{default:s(()=>[x($(f.value?"Hide":"Show")+" completed zones",1)]),_:1})]),_:1},8,["outline"]),r(q,{dense:"",size:"sm",color:"warning",icon:"visibility",onClick:t[1]||(t[1]=m=>g.value=!g.value),outline:!g.value},{default:s(()=>[r(k,null,{default:s(()=>[x($(g.value?"Hide":"Show")+" incomplete zones",1)]),_:1})]),_:1},8,["outline"]),r(q,{dense:"",size:"sm",color:"info",icon:"center_focus_strong",onClick:M},{default:s(()=>[r(k,null,{default:s(()=>t[3]||(t[3]=[x("Center on Ste. Anne",-1)])),_:1,__:[3]})]),_:1})])]),_:1,__:[4]})]),r(q,{round:"",color:"white","text-color":"grey-8",icon:"refresh",onClick:b,class:"q-mb-sm"},{default:s(()=>[r(k,null,{default:s(()=>t[5]||(t[5]=[x("Refresh Map",-1)])),_:1,__:[5]})]),_:1})]),d.value?(B(),O("div",Ae,[r(H,{flat:"",bordered:""},{default:s(()=>[r(me,{dense:"",class:"q-pa-sm"},{default:s(()=>[_("div",Ie,$(d.value.name),1),_("div",Oe,$(d.value.scheduledDay)+" â¢ "+$(d.value.priority)+" priority ",1),_("div",Ne,[r(ye,{color:d.value.completed?"positive":"warning","text-color":"white",size:"sm",icon:"schedule"},{default:s(()=>[x($(d.value.completed?"Completed":"Incomplete"),1)]),_:1},8,["color"])])]),_:1})]),_:1})])):R("",!0)])),r(be),N(o).screen.lt.md?(B(),j(Fe,{key:2,position:"bottom-right",offset:[18,18]},{default:s(()=>[r(qe,{icon:"add",direction:"up",color:"primary",disable:N(n).loading},{default:s(()=>[r(Z,{color:"positive",icon:"check_circle",onClick:Q},{default:s(()=>[r(k,{anchor:"center left",self:"center right"},{default:s(()=>t[6]||(t[6]=[x(" Mark today's zones complete ",-1)])),_:1,__:[6]})]),_:1}),r(Z,{color:"info",icon:"map",onClick:M},{default:s(()=>[r(k,{anchor:"center left",self:"center right"},{default:s(()=>t[7]||(t[7]=[x(" Center map ",-1)])),_:1,__:[7]})]),_:1}),r(Z,{color:"warning",icon:"refresh",onClick:b},{default:s(()=>[r(k,{anchor:"center left",self:"center right"},{default:s(()=>t[8]||(t[8]=[x(" Refresh zones ",-1)])),_:1,__:[8]})]),_:1})]),_:1},8,["disable"])]),_:1})):R("",!0)]),_:1}))}},Ue=_e(Ze,[["__scopeId","data-v-0d1d3db6"]]);export{Ue as default};
